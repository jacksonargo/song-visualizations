(this["webpackJsonpsong-visualizations"]=this["webpackJsonpsong-visualizations"]||[]).push([[4],{273:function(e,t,n){"use strict";n.r(t),n.d(t,"FeaturesByGenreVis",(function(){return y}));var r=n(10),i=n(27),s=n(275),a=n(271),o=n(272),c=n(276),u=n(274),l=n(123),g=n(2),h=n(270),d=n(70),f=n.p+"static/media/spotify_decades.d5ba62b9.csv",v=function e(t){for(var n in Object(d.a)(this,e),this.name="",this.artist="",this.album_name="",this.album_image_url="",this.album_release_date="",this.duration_ms="",this.explicit="",this.popularity="",this.preview_url="",this.danceability="",this.energy="",this.key="",this.loudness="",this.mode="",this.speechiness="",this.acousticness="",this.instrumentalness="",this.liveness="",this.valence="",this.tempo="",this.time_signature="",this.artist_followers="",this.artist_genres="",this.artist_popularity="",this.track_id="",t){var r;this[n]=null!==(r=t[n])&&void 0!==r?r:""}};var j=n(71),b=n(224),m=["danceability","energy","speechiness","acousticness","instrumentalness","liveness","valence"],p=function(){function e(t){var n=this;Object(d.a)(this,e),this.rows=void 0,this.genres=void 0,this.genreCounts=void 0;var r=t.flatMap((function(e){return e.artist_genres.replaceAll(/[[\]'"]/gi,"").split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))}));this.rows=t,this.genreCounts=r.reduce((function(e,t){var n;return e.set(t,1+(null!==(n=e.get(t))&&void 0!==n?n:0))}),new Map),console.log(this.genreCounts),this.genres=Object(l.uniq)(r).sort((function(e,t){var r,i,s=null!==(r=n.genreCounts.get(e))&&void 0!==r?r:0,a=null!==(i=n.genreCounts.get(t))&&void 0!==i?i:0;return s===a?e.localeCompare(t):s-a}))}return Object(j.a)(e,[{key:"toGenreVisData",value:function(){return this.rows.flatMap((function(e){var t=e.album_release_date.slice(0,4);return m.map((function(n){return{year:Number(t),feature_name:n,value:e[n]?Number(e[n]):0,genres:e.artist_genres.replaceAll(/[[\]'"]/gi,"").split(",").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))}}))}))}}],[{key:"fromBlob",value:function(t){return new e(b.a(t).map((function(e){return new v(e)})))}}]),e}();function O(e,t,n,r,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:300,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:800;return{$schema:"https://vega.github.io/schema/vega-lite/v5.json",mark:{type:"area"},title:e,width:a,height:s,data:{values:t.filter((function(e){return 0===n.length||e.genres.filter((function(e){return null===n||void 0===n?void 0:n.includes(e)})).length>0})).filter((function(e){return e.year>=r})).filter((function(e){return e.year<=i}))},encoding:{x:{field:"year",type:"quantitative",title:"Year",axis:{format:"d"}},y:{aggregate:"sum",field:"value",title:"Feature Dominance",stack:"normalize"},color:{field:"feature_name",type:"nominal",title:"Audio Feature"}}}}var x=n(7);function y(){var e=function(){var e=Object(g.useState)(sessionStorage.getItem("dataBytes")),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(g.useEffect)((function(){var e;(null!==(e=null===n||void 0===n?void 0:n.length)&&void 0!==e?e:0)>0||fetch(f).then((function(e){return e.text()})).then((function(e){e&&(r(e),sessionStorage.setItem("dataBytes",e))}))})),n}(),t=Object(g.useState)(new Map),n=Object(i.a)(t,2),r=n[0],a=n[1];if(!e)return Object(x.jsx)("p",{children:"Loading..."});var o=p.fromBlob(e),c=o.genres.reverse(),u=Array.from(r.keys()).filter((function(e){return r.get(e)}));return Object(x.jsxs)(s.a,{container:!0,children:[Object(x.jsx)(s.a,{item:!0,xs:12,children:Object(x.jsx)("h2",{children:"Genres"})}),Object(x.jsxs)(s.a,{container:!0,columnSpacing:2,children:[Object(x.jsx)(s.a,{item:!0,sm:2,children:Object(x.jsx)(_,{genreToggles:r,setGenreToggles:a,options:c,selected:u})}),Object(x.jsx)(s.a,{item:!0,sm:10,children:Object(x.jsx)(T,{baseTitle:"Variation in Features",data:o.toGenreVisData(),genres:u})})]})]})}function _(e){var t=Object(g.useState)(""),n=Object(i.a)(t,2),o=n[0],c=n[1],u=e.options.filter((function(e){return e&&e.toLowerCase().includes(o)})).slice(0,5),h=Object(l.uniq)([].concat(Object(r.a)(u),Object(r.a)(e.selected)));return Object(x.jsxs)(s.a,{container:!0,children:[Object(x.jsx)(s.a,{item:!0,xs:12,children:Object(x.jsx)(a.a,{label:"search genres",variant:"standard",onChange:function(e){return c(e.target.value)}})}),Object(x.jsxs)(s.a,{item:!0,xs:12,children:[Object(x.jsx)("h4",{children:"Top matches"}),Object(x.jsx)(w,{genreToggles:e.genreToggles,setGenreToggles:e.setGenreToggles,options:h})]})]})}function w(e){function t(t){return Object(x.jsx)(o.a,{value:e.genreToggles.get(t),onChange:function(n){var r=new Map(e.genreToggles);r.set(t,n.target.checked),e.setGenreToggles(r)}})}return Object(x.jsx)(c.a,{children:e.options.map((function(e){return Object(x.jsx)(u.a,{control:t(e),label:e},e)}))})}function T(e){var t,n,r,i=null!==(t=e.yearStart)&&void 0!==t?t:0,s=null!==(n=e.yearEnd)&&void 0!==n?n:3e3,a=e.baseTitle;return e.genres&&e.genres.length>0&&(a+=" | "+e.genres[0].replace(/^\w/,(function(e){return e.toUpperCase()}))),e.genres&&e.genres.length>1&&(a+=", and others"),Object(x.jsx)(h.a,{spec:O(a,e.data,null!==(r=e.genres)&&void 0!==r?r:[],i,s)})}t.default=y}}]);
//# sourceMappingURL=4.a046bd84.chunk.js.map